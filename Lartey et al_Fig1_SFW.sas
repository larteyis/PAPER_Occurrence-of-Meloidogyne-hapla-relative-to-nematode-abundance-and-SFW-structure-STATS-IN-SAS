DATA NRKNPV_DATA;
INPUT xx	COMB	RP 	RG	ST	NRKN	LU	SI	EI;
cards;
1	11	1	1	2	0	1	49	26
1	11	2	1	2	0	1	33	0
1	11	3	1	2	0	1	49	9
1	11	4	1	2	0	1	44	47
1	11	5	1	2	0	1	41	0
2	110	1	1	2	1	1	19	43
2	110	2	1	2	1	1	28	0
2	110	3	1	2	1	1	5	62
2	110	4	1	2	1	1	17	76
2	110	5	1	2	1	1	0	80
3	111	1	1	2	0	1	39	13
3	111	2	1	2	0	1	37	0
3	111	3	1	2	0	1	52	0
3	111	4	1	2	0	1	52	38
3	111	5	1	2	0	1	42	89
4	112	1	1	1	1	1	51	61
4	112	2	1	1	1	1	40	60
4	112	3	1	1	1	1	36	61
4	112	4	1	1	1	1	62	51
4	112	5	1	1	1	1	57	86
5	113	1	1	1	1	1	37	41
5	113	2	1	1	1	1	49	13
5	113	3	1	1	1	1	47	0
5	113	4	1	1	1	1	50	0
5	113	5	1	1	1	1	25	0
6	114	1	1	1	1	1	0	89
6	114	2	1	1	1	1	50	76
6	114	3	1	1	1	1	27	58
6	114	4	1	1	1	1	34	40
6	114	5	1	1	1	1	17	65
7	115	1	2	2	0	1	43	0
7	115	2	2	2	0	1	46	0
7	115	3	2	2	0	1	28	65
7	115	4	2	2	0	1	35	13
7	115	5	2	2	0	1	45	13
8	12	1	2	2	1	1	54	0
8	12	2	2	2	1	1	29	50
8	12	3	2	2	1	1	20	0
8	12	4	2	2	1	1	86	57
8	12	5	2	2	1	1	51	38
9	13	1	2	2	0	1	32	2
9	13	2	2	2	0	1	28	0
9	13	3	2	2	0	1	35	20
9	13	4	2	2	0	1	38	0
9	13	5	2	2	0	1	37	0
10	14	1	2	1	1	1	48	78
10	14	2	2	1	1	1	40	67
10	14	3	2	1	1	1	32	20
10	14	4	2	1	1	1	43	63
10	14	5	2	1	1	1	47	30
11	15	1	3	2	0	1	64	84
11	15	2	3	2	0	1	57	93
11	15	3	3	2	0	1	50	65
11	15	4	3	2	0	1	41	93
11	15	5	3	2	0	1	67	92
12	16	1	3	2	0	1	67	85
12	16	2	3	2	0	1	60	94
12	16	3	3	2	0	1	52	67
12	16	4	3	2	0	1	44	94
12	16	5	3	2	0	1	67	92
13	17	1	3	2	1	1	29	47
13	17	2	3	2	1	1	43	17
13	17	3	3	2	1	1	15	4
13	17	4	3	2	1	1	26	44
13	17	5	3	2	1	1	44	25
14	18	1	3	1	1	1	36	54
14	18	2	3	1	1	1	38	20
14	18	3	3	1	1	1	41	70
14	18	4	3	1	1	1	31	37
14	18	5	3	1	1	1	55	33
15	19	1	3	1	1	1	41	16
15	19	2	3	1	1	1	29	12
15	19	3	3	1	1	1	35	20
15	19	4	3	1	1	1	45	13
15	19	5	3	1	2	1	35	0
16	21	1	1	2	0	1	42	23
16	21	2	1	2	0	1	31	40
16	21	3	1	2	0	1	65	15
16	21	4	1	2	0	1	24	46
16	21	5	1	2	0	1	73	20
17	210	1	1	2	1	1	55	39
17	210	2	1	2	1	1	20	0
17	210	3	1	2	1	1	70	74
17	210	4	1	2	1	1	70	77
17	210	5	1	2	1	1	8	42
18	211	1	1	2	0	1	63	0
18	211	2	1	2	0	1	26	15
18	211	3	1	2	0	1	28	48
18	211	4	1	2	0	1	29	15
18	211	5	1	2	0	1	40	25
19	212	1	1	1	1	1	67	83
19	212	2	1	1	1	1	64	84
19	212	3	1	1	1	1	35	67
19	212	4	1	1	1	1	29	48
19	212	5	1	1	1	1	80	96
20	213	1	1	1	1	1	63	0
20	213	2	1	1	1	1	26	15
20	213	3	1	1	1	1	28	48
20	213	4	1	1	1	1	29	15
20	213	5	1	1	1	1	40	25
21	214	1	1	1	1	1	41	74
21	214	2	1	1	1	1	33	80
21	214	3	1	1	1	1	30	83
21	214	4	1	1	1	1	44	61
21	214	5	1	1	1	1	35	76
22	215	1	2	2	0	1	41	74
22	215	2	2	2	0	1	33	80
22	215	3	2	2	0	1	30	83
22	215	4	2	2	0	1	44	61
22	215	5	2	2	0	1	35	76
23	22	1	2	2	1	1	61	74
23	22	2	2	2	1	1	31	84
23	22	3	2	2	1	1	57	38
23	22	4	2	2	1	1	43	79
23	22	5	2	2	1	1	24	55
24	23	1	2	2	0	1	61	74
24	23	2	2	2	0	1	31	84
24	23	3	2	2	0	1	57	38
24	23	4	2	2	0	1	43	79
24	23	5	2	2	0	1	24	55
25	24	1	2	1	1	1	44	16
25	24	2	2	1	1	1	11	52
25	24	3	2	1	1	1	60	67
25	24	4	2	1	1	1	55	80
25	24	5	2	1	1	1	14	43
26	25	1	3	2	0	1	44	16
26	25	2	3	2	0	1	11	52
26	25	3	3	2	0	1	60	67
26	25	4	3	2	0	1	55	80
26	25	5	3	2	0	1	14	23
27	26	1	3	2	0	1	44	16
27	26	2	3	2	0	1	11	52
27	26	3	3	2	0	1	60	67
27	26	4	3	2	0	1	55	80
27	26	5	3	2	0	1	14	23
28	27	1	3	2	1	1	39	34
28	27	2	3	2	1	1	41	48
28	27	3	3	2	1	1	23	29
28	27	4	3	2	1	1	16	0
28	27	5	3	2	1	1	14	8
29	28	1	3	1	1	1	19	48
29	28	2	3	1	1	1	37	73
29	28	3	3	1	1	1	36	69
29	28	4	3	1	1	1	41	79
29	28	5	3	1	1	1	57	63
30	29	1	3	1	1	1	81	73
30	29	2	3	1	1	1	39	62
30	29	3	3	1	1	1	27	27
30	29	4	3	1	1	1	30	52
30	29	5	3	1	2	1	64	65
;

/*Part I. Input Data into SAS*/ 

proc print data=NRKNPV_DATA;
run;

/****** Part II Modeling & Graphing ******/

/*** Part A. Mixed Modeling for SI & EI ******/

proc mixed data=NRKNPV_DATA; /*SI Model*/
class COMB RP;
model SI=COMB/ddfm=kr;
random RP;
lsmeans COMB;
ods output lsmeans=mymean_SI;
run;
proc print data=mymean_SI;  run;


proc mixed data=NRKNPV_DATA; /*EI Model*/
class COMB RP;
model EI=COMB/ddfm=kr;
random RP;
lsmeans COMB;
ods output lsmeans=mymean_EI;
run;
proc print data=mymean_EI;  run;


/*** Part B. Prepare Data for Plotting ******/

data mymean_EI_1;
set mymean_EI;
rename Estimate=EI_Est StdErr=EI_SE;
run;
proc print; run;

data mymean_SI_1;
set mymean_SI;
rename Estimate=SI_Est StdErr=SI_SE;
run;
proc print; run;

/*Merge both EI and SI together*/

data mymean_EISI;
set mymean_EI_1;
set mymean_SI_1;
run;
proc print data=mymean_EISI; run;


data mymean_EISI_1;  /*add variable labels in the merged data set*/
set mymean_EISI;
if COMB=11 then COMB1='JackWallinga';
if COMB=21 then COMB1='JackWallinga';
if COMB=12 then COMB1='PZ';
if COMB=22 then COMB1='PZ';
if COMB=13 then COMB1='PZtwo';
if COMB=23 then COMB1='PZtwo';
if COMB=14 then COMB1='EB1Rone';
if COMB=24 then COMB1='EB1Rone';
if COMB=15 then COMB1='EB2Rtwo';
if COMB=25 then COMB1='EB2Rtwo';
if COMB=16 then COMB1='EB3Rthree';
if COMB=26 then COMB1='EB3Rthree';
if COMB=17 then COMB1='PN';
if COMB=27 then COMB1='PN';
if COMB=18 then COMB1='L';
if COMB=28 then COMB1='L';
if COMB=19 then COMB1='M';
if COMB=29 then COMB1='M';
if COMB=110 then COMB1='ED';
if COMB=210 then COMB1='ED';
if COMB=111 then COMB1='OFtwo';
if COMB=211 then COMB1='OFtwo';
if COMB=112 then COMB1='OBtwo';
if COMB=212 then COMB1='OBtwo';
if COMB=113 then COMB1='OF';
if COMB=213 then COMB1='OF';
if COMB=114 then COMB1='VS';
if COMB=214 then COMB1='VS';
if COMB=115 then COMB1='JWA';
if COMB=215 then COMB1='JWA';



if COMB=11 then cpid='Agricultural';
if COMB=21 then cpid='Natural';
if COMB=12 then cpid='Agricultural';
if COMB=22 then cpid='Natural';
if COMB=13 then cpid='Agricultural';
if COMB=23 then cpid='Natural';
if COMB=14 then cpid='Agricultural';
if COMB=24 then cpid='Natural';
if COMB=15 then cpid='Agricultural';
if COMB=25 then cpid='Natural';
if COMB=16 then cpid='Agricultural';
if COMB=26 then cpid='Natural';
if COMB=17 then cpid='Agricultural';
if COMB=27 then cpid='Natural';
if COMB=18 then cpid='Agricultural';
if COMB=28 then cpid='Natural';
if COMB=19 then cpid='Agricultural';
if COMB=29 then cpid='Natural';
if COMB=110 then cpid='Agricultural';
if COMB=210 then cpid='Natural';
if COMB=111 then cpid='Agricultural';
if COMB=211 then cpid='Natural';
if COMB=112 then cpid='Agricultural';
if COMB=212 then cpid='Natural';
if COMB=113 then cpid='Agricultural';
if COMB=213 then cpid='Natural';
if COMB=114 then cpid='Agricultural';
if COMB=214 then cpid='Natural';
if COMB=115 then cpid='Agricultural';
if COMB=215 then cpid='Natural';




xl=SI_Est-(SI_SE)*(1.96);  /*create lower-limit error bars for x-axis*/
xu=SI_Est+(SI_SE)*(1.96);  /*create upper-limit error bars for x-axis*/
yl=EI_Est-(EI_SE)*(1.96);   /*create lower-limit error bars for y-axis*/
yu=EI_Est+(EI_SE)*(1.96);   /*create upper-limit error bars for y-axis*/
run;
proc print data=mymean_EISI_1;
run;

/*Final Stage. Plot both SI_x and EI_y */

ods graphics/reset=all;
ods graphics/height=10in attrpriority=none border=off;
ods html style=journal image_dpi=300; /*10" & 7.5"*/
proc sgpanel data=mymean_EISI_1 noautolegend;
panelby cpid COMB1 / layout=lattice  SORT=data 
novarname onepanel colheaderpos=top HEADErATTRS=(Color=Black Family='Times Roman'  Size=11 Weight=Normal);
refline 50 / axis=x lineattrs=(thickness=2 pattern=shortdash);
refline 50 / axis=y lineattrs=(thickness=2 pattern=shortdash);

series x=SI_Est y=EI_Est/   ;
scatter x=SI_Est y=EI_Est/ markerattrs=(symbol=CircleFilled)
YERRORLOWER=yl YERRORUPPER=yu  XERRORLOWER=xl XERRORUPPER=xu Errorbarattrs=(pattern=1 thickness=0.2pct);

rowaxis LABEL = 'Enrichment Index (%)'  GRID
LABELATTRS=(Color=Black Family='Times Roman'  Size=12 Weight=Normal)
 VALUEATTRS=(Color=Black Family='Times Roman' Size=10  ) VALUES = (0 TO 100 BY 50) display=(nolabel);

colaxis LABEL = 'Structure Index (%)' grid
LABELATTRS=(Color=Black Family='Times Roman'  Size=12 Weight=Normal)
VALUEATTRS=(Color=Black Family='Times Roman' Size=10) VALUES = (0 TO 100 BY 50) display=(nolabel); 
run;
